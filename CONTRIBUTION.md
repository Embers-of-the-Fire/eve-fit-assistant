# Contribute to *EVE Fit Assistant*

## Environment setup

The project requires a minimum of 3 languages/pack to be installed on your system:

- Flutter 3.27 or higher with Dart 3.6 or higher, to build the application.
- Python 3.12 or higher with UV as env manager, to generate data bundles.
- Rust 1.83 or higher with edition 2021, to build the native fit engine.

### Flutter configuration

The project does not use something like fvm to manage the Flutter version.

The currently use Flutter version is suggested to be:

```text
Flutter 3.27.3 • channel stable • https://github.com/flutter/flutter.git
Framework • revision c519ee916e (3 weeks ago) • 2025-01-21 10:32:23 -0800
Engine • revision e672b006cb
Tools • Dart 3.6.1 • DevTools 2.40.2
```

But any version higher should be compatible.

After installing Flutter, run the following command to install dependencies:

```bash
flutter pub get
```

**Note:** The project is developed targeting China, so the repository uses a mirror
for pub.dev. If you are outside China, you may want to ignore the `pubspec.lock`
in order to download dependencies from the official source.

### Python configuration

The project uses Python to generate data bundles.

First, install [UV](https://docs.astral.sh/uv/). For example:

```bash
pip install uv>=0.5
```

Then, run the following command to setup the environment and install dependencies:

```bash
uv sync
```

### Rust configuration

The project uses standard Rust build system, that is, `rustup` + `Cargo`.

To build the native ffi glue, you have to install `flutter_rust_bridge_codegen`:

```bash
cargo install --locked flutter_rust_bridge_codegen
```

It is suggested to run the codegen before developing, to ensure that your rust environment is
correctly setup.  
Run the following command to generate the ffi glue:

```bash
flutter_rust_bridge_codegen generate
```

For more information about `flutter_rust_bridge`,
see [its documentation](https://cjycode.com/flutter_rust_bridge/).

## Build the application

The app uses several external scripts to build the application.

### Generating dart code

The app uses [`freezed`](https://pub.dev/packages/freezed) and
[`json_serializable`](https://pub.dev/packages/json_serializable)
to generate some extra dart code.

Run the following to generate the code:

```bash
dart run build_runner build --delete-conflicting-outputs
```

### Building the native engine

The app uses a native engine written in Rust.

If you have not generated the ffi glue or have changed the native code, run the following command:

```bash
flutter_rust_bridge_codegen generate
```

**Note:** The native engine is built on `eve-fit-os`, which is maintained in another repository,
and is included as a submodule located at `./rust/lib/eve-fit-os`.
You have to clone the submodule before building the native engine.

### Creating the data bundles

All data bundles are generated by Python scripts.  
Most of them are in the `./data` directory, but some of the data is only used by the fit engine
and is located in the `./rust/lib/eve-fit-os/data` directory.
Read [its documentation](./rust/lib/eve-fit-os/README.md) for more information.

To generate the data bundles, see [this page](./data/README.md) for more information.
